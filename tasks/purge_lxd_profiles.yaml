---
- name: Check profiles existence in physical servers
  include_tasks: check_profile_existance.yaml
  with_items: "{{ groups['physical_servers'] }}"
  vars:
    not_existing_profiles: []
    existing_profiles: []
  loop_control:
    loop_var: physical_server_item

- name: Print existing profiles
  debug:
    msg: "{{ item }}"
  with_items: "{{ existing_profiles }}"
  when: existing_profiles is defined

- name: Prompt to confirm
  pause:
    prompt: Please confirm you want to delete specified Profiles. Press return to continue. Press Ctrl+c and then "a" to abort

- name: Create cpu limit in needed profiles
  shell: "lxc profile delete {{ item }}"
  with_items: "{{ existing_profiles }}"
  when: existing_profiles is defined